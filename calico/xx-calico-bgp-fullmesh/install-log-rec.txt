scp root@192.168.2.100:/root/tools/calicoctl /usr/bin/
chmod +x /usr/bin/calicoctl
kubectl apply -f ./calico.yaml
configmap/calico-config created
customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/caliconodestatuses.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/ipreservations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/kubecontrollersconfigurations.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created
customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created
clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created
clusterrole.rbac.authorization.k8s.io/calico-node created
clusterrolebinding.rbac.authorization.k8s.io/calico-node created
daemonset.apps/calico-node created
serviceaccount/calico-node created
deployment.apps/calico-kube-controllers created
serviceaccount/calico-kube-controllers created
poddisruptionbudget.policy/calico-kube-controllers created

kubectl get nodes -owide
NAME   STATUS     ROLES                  AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
bpf1   NotReady   control-plane,master   9d    v1.23.4   192.168.2.71   <none>        Ubuntu 20.04.5 LTS   5.15.0-52-generic   docker://20.10.21
bpf2   NotReady   <none>                 9d    v1.23.4   192.168.2.72   <none>        Ubuntu 20.04.5 LTS   5.15.0-52-generic   docker://20.10.21
bpf3   NotReady   <none>                 9d    v1.23.4   192.168.2.73   <none>        Ubuntu 20.04.5 LTS   5.15.0-52-generic   docker://20.10.21

kubectl get pods -owide -A
NAMESPACE     NAME                                       READY   STATUS      RESTARTS        AGE    IP             NODE     NOMINATED NODE   READINESS GATES
kube-system   calico-kube-controllers-7d77d66bd7-ddhhj   0/1     Pending     0               0s     <none>         <none>   <none>           <none>
kube-system   calico-node-5l7k7                          0/1     Init:0/2    0               0s     192.168.2.73   bpf3     <none>           <none>
kube-system   calico-node-d77p7                          0/1     Init:0/2    0               0s     192.168.2.71   bpf1     <none>           <none>
kube-system   calico-node-gcgbg                          0/1     Init:0/2    0               0s     192.168.2.72   bpf2     <none>           <none>
kube-system   coredns-7b888c7f44-knf7l                   0/1     Completed   0               7d3h   <none>         bpf2     <none>           <none>
kube-system   coredns-7b888c7f44-vhg82                   0/1     Completed   0               7d3h   <none>         bpf3     <none>           <none>
kube-system   etcd-bpf1                                  1/1     Running     10 (7d3h ago)   9d     192.168.2.71   bpf1     <none>           <none>
kube-system   kube-apiserver-bpf1                        1/1     Running     11 (7d3h ago)   9d     192.168.2.71   bpf1     <none>           <none>
kube-system   kube-controller-manager-bpf1               1/1     Running     10 (7d3h ago)   9d     192.168.2.71   bpf1     <none>           <none>
kube-system   kube-proxy-7zkvw                           1/1     Running     6 (7d3h ago)    9d     192.168.2.72   bpf2     <none>           <none>
kube-system   kube-proxy-pl2pk                           1/1     Running     7 (7d3h ago)    9d     192.168.2.73   bpf3     <none>           <none>
kube-system   kube-proxy-wmv2v                           1/1     Running     10 (7d3h ago)   9d     192.168.2.71   bpf1     <none>           <none>
kube-system   kube-scheduler-bpf1                        1/1     Running     12 (7d3h ago)   9d     192.168.2.71   bpf1     <none>           <none>

cat <<EOF | kubectl apply -f -
apiVersion: apps/v1
kind: DaemonSet
metadata:
  labels:
    app: calico-bgp-fullmesh
  name: calico-bgp-fullmesh
spec:
  selector:
    matchLabels:
      app: calico-bgp-fullmesh
  template:
    metadata:
      labels:
        app: calico-bgp-fullmesh
    spec:
      containers:
      - image: 192.168.2.100:5000/nettool
        name: nettoolbox
        securityContext:
          privileged: true
---
apiVersion: v1
kind: Service
metadata:
  name: serversvc
spec:
  type: NodePort
  selector:
    app: calico-bgp-fullmesh
  ports:
  - name: calico-bgp-fullmesh
    port: 8080
    targetPort: 80
    nodePort: 32000
EOF
daemonset.apps/calico-bgp-fullmesh created
service/serversvc created

ip -d link show
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 promiscuity 0 minmtu 0 maxmtu 0 addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 
2: ens160: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP mode DEFAULT group default qlen 1000
    link/ether 00:0c:29:67:92:63 brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 60 maxmtu 9000 addrgenmode none numtxqueues 6 numrxqueues 6 gso_max_size 65536 gso_max_segs 65535 
    altname enp3s0
3: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default 
    link/ether 02:42:27:2b:95:b6 brd ff:ff:ff:ff:ff:ff promiscuity 0 minmtu 68 maxmtu 65535 
    bridge forward_delay 1500 hello_time 200 max_age 2000 ageing_time 30000 stp_state 0 priority 32768 vlan_filtering 0 vlan_protocol 802.1Q bridge_id 8000.2:42:27:2b:95:b6 designated_root 8000.2:42:27:2b:95:b6 root_port 0 root_path_cost 0 topology_change 0 topology_change_detected 0 hello_timer    0.00 tcn_timer    0.00 topology_change_timer    0.00 gc_timer   30.27 vlan_default_pvid 1 vlan_stats_enabled 0 vlan_stats_per_port 0 group_fwd_mask 0 group_address 01:80:c2:00:00:00 mcast_snooping 1 mcast_router 1 mcast_query_use_ifaddr 0 mcast_querier 0 mcast_hash_elasticity 16 mcast_hash_max 4096 mcast_last_member_count 2 mcast_startup_query_count 2 mcast_last_member_interval 100 mcast_membership_interval 26000 mcast_querier_interval 25500 mcast_query_interval 12500 mcast_query_response_interval 1000 mcast_startup_query_interval 3124 mcast_stats_enabled 0 mcast_igmp_version 2 mcast_mld_version 1 nf_call_iptables 0 nf_call_ip6tables 0 nf_call_arptables 0 addrgenmode eui64 numtxqueues 1 numrxqueues 1 gso_max_size 65536 gso_max_segs 65535 
5: vethad2375c@if4: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue master docker0 state UP mode DEFAULT group default 
    link/ether 16:57:a6:8a:9b:66 brd ff:ff:ff:ff:ff:ff link-netnsid 0 promiscuity 1 minmtu 68 maxmtu 65535 
    veth 
    bridge_slave state forwarding priority 32 cost 2 hairpin off guard off root_block off fastleave off learning on flood on port_id 0x8001 port_no 0x1 designated_port 32769 designated_cost 0 designated_bridge 8000.2:42:27:2b:95:b6 designated_root 8000.2:42:27:2b:95:b6 hold_timer    0.00 message_age_timer    0.00 forward_delay_timer    0.00 topology_change_ack 0 config_pending 0 proxy_arp off proxy_arp_wifi off mcast_router 1 mcast_fast_leave off mcast_flood on mcast_to_unicast off neigh_suppress off group_fwd_mask 0 group_fwd_mask_str 0x0 vlan_tunnel off isolated off addrgenmode eui64 numtxqueues 128 numrxqueues 128 gso_max_size 65536 gso_max_segs 65535 
